# 图标缓存机制测试说明

## 优化后的缓存机制特点

### 1. 智能缓存策略
- **真实图标缓存**: 7天有效期
- **首字母图标缓存**: 1天有效期，但会在后台尝试获取真实图标
- **自动过期清理**: 应用启动时自动清理过期缓存

### 2. 多级图标获取
1. `https://domain.com/favicon.ico` (带时间戳)
2. `https://icons.duckduckgo.com/ip3/domain.ico`
3. `https://www.google.com/s2/favicons?domain=domain&sz=64`
4. `https://domain.com/apple-touch-icon.png` (带时间戳)

### 3. 浏览器缓存优化
- 添加每日时间戳参数，确保图标每天更新一次
- 压缩图标质量为0.8，减少存储空间
- 限制单个图标最大100KB

### 4. 存储空间管理
- 监控存储使用情况
- 超过5MB时自动清理较老的缓存
- 记录缓存大小和清理日志

### 5. 后台智能更新
- 首字母图标显示后，在后台尝试获取真实图标
- 成功获取后自动更新显示
- 不影响用户当前的浏览体验

## 测试方法

1. **首次加载测试**
   - 清空所有缓存
   - 添加新网站，观察图标加载过程

2. **缓存命中测试**
   - 重新加载页面
   - 观察图标是否从缓存快速加载

3. **过期更新测试**
   - 修改系统时间模拟过期
   - 观察缓存是否正确更新

4. **存储空间测试**
   - 添加大量网站
   - 观察存储空间管理是否正常

## 预期效果

- 图标加载速度显著提升
- 减少网络请求
- 智能的缓存更新机制
- 合理的存储空间使用
